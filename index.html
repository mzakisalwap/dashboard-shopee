<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Bisnis Shopee â€“ Final</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#f4f6fb;--card:#ffffff;--primary:#6c63ff;--success:#2ecc71;--warning:#f39c12;--danger:#e74c3c;
}
body{margin:0;font-family:Segoe UI,Arial;background:var(--bg)}
#loginBox{max-width:360px;margin:120px auto;background:var(--card);padding:25px;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.12)}
#loginBox h2{text-align:center}
#loginBox input,#loginBox button{width:100%;padding:12px;margin:10px 0;border-radius:10px;border:1px solid #ddd}
#loginBox button{background:var(--primary);color:#fff;border:none;font-weight:600;cursor:pointer}
#app{display:none;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}
.header h2{margin:0}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;margin-top:20px}
.card{background:var(--card);padding:18px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
.card h3{margin:0 0 8px 0;font-size:14px;color:#555}
.card b{font-size:22px}
.table-wrap{margin-top:25px}
table{width:100%;border-collapse:collapse;background:var(--card);border-radius:18px;overflow:hidden}
th,td{padding:10px;text-align:center;border-bottom:1px solid #eee;font-size:14px}
th{background:#f1f3ff}
input,select{padding:6px;border-radius:8px;border:1px solid #ddd}
button{padding:8px 14px;border-radius:10px;border:none;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-success{background:var(--success);color:#fff}
.admin-only{}
.hidden{display:none}
.status-Packing{background:#fff3cd}
.status-Dikirim{background:#d1ecf1}
.status-Selesai{background:#d4edda}
.status-Return{background:#f8d7da}
footer{text-align:center;color:#888;font-size:12px;margin-top:30px}
@media(max-width:768px){th,td{font-size:12px}}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>Login Dashboard</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app">
  <div class="header">
    <h2>ðŸ“Š Dashboard Bisnis Shopee</h2>
    <div>
      <span id="roleInfo"></span> |
      <span id="today"></span>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div class="dashboard">
    <div class="card"><h3>Total Order</h3><b id="totalOrder">0</b></div>
    <div class="card"><h3>Packing</h3><b id="packing">0</b></div>
    <div class="card"><h3>Dikirim</h3><b id="dikirim">0</b></div>
    <div class="card"><h3>Selesai</h3><b id="selesai">0</b></div>
    <div class="card"><h3>Return</h3><b id="retur">0</b></div>
    <div class="card"><h3>Total Profit</h3><b id="profit">Rp 0</b></div>
  </div>

  <!-- GRAFIK -->
  <div class="card" style="margin-top:25px">
    <canvas id="profitChart" height="90"></canvas>
  </div>

  <!-- TABLE ORDER -->
  <div class="table-wrap">
    <h3>ðŸ“¦ Tabel Order</h3>
    <button class="btn-primary" onclick="addRow()">+ Tambah Order</button>
    <button class="btn-success admin-only" onclick="exportCSV()">Export CSV</button>
    <table id="tableOrder">
      <thead>
        <tr>
          <th>Tanggal</th><th>No Pesanan</th><th>Produk</th><th>Modal</th><th>Jual</th><th>Margin</th><th>Status</th><th class="admin-only">Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- TABLE USER MANAGEMENT -->
  <div class="table-wrap admin-only">
    <h3>ðŸ‘¥ Manajemen User</h3>
    <input id="newUser" placeholder="Username">
    <input id="newPass" placeholder="Password">
    <select id="newRole">
      <option value="staff">Staff</option>
      <option value="admin">Admin</option>
    </select>
    <button class="btn-primary" onclick="addUser()">Tambah User</button>
    <table id="userTable">
      <thead>
        <tr><th>Username</th><th>Role</th><th>Aksi</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <footer>Dashboard Shopee â€¢ Final Business System</footer>
</div>

<script>
/* ===== USER SYSTEM ===== */
const USERS_KEY='shopee_users';
const ORDER_KEY='shopee_orders';

if(!localStorage.getItem(USERS_KEY)){
  localStorage.setItem(USERS_KEY,JSON.stringify([
    {username:'owner',password:'owner123',role:'owner'},
    {username:'admin',password:'admin123',role:'admin'},
    {username:'staff',password:'staff123',role:'staff'}
  ]));
}

function login(){
  const u=username.value.trim();
  const p=password.value.trim();
  const users=JSON.parse(localStorage.getItem(USERS_KEY));
  const found=users.find(x=>x.username===u&&x.password===p);
  if(!found){alert('Login gagal');return;}
  localStorage.setItem('currentUser',JSON.stringify(found));
  loginBox.style.display='none';
  app.style.display='block';
  roleInfo.innerText='Role: '+found.role.toUpperCase();
  today.innerText=new Date().toLocaleDateString('id-ID',{day:'2-digit',month:'long',year:'numeric'});
  if(found.role==='staff')document.querySelectorAll('.admin-only').forEach(e=>e.style.display='none');
  loadOrders(); loadUsers();
}

function logout(){localStorage.removeItem('currentUser');location.reload();}

/* ===== ORDER ===== */
function addRow(d={}){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input type=date value="${d.tanggal||''}"></td>
    <td><input value="${d.no||''}"></td>
    <td><input value="${d.produk||''}"></td>
    <td><input type=number value="${d.modal||0}" oninput=calc(this)></td>
    <td><input type=number value="${d.jual||0}" oninput=calc(this)></td>
    <td class=margin>0</td>
    <td>
      <select onchange="update()">
        <option>Packing</option><option>Dikirim</option><option>Selesai</option><option>Return</option>
      </select>
    </td>
    <td class="admin-only"><button class="btn-danger" onclick="this.closest('tr').remove();update()">Hapus</button></td>`;
  tableOrder.querySelector('tbody').appendChild(tr);
  if(d.status)tr.querySelector('select').value=d.status;
  calc(tr.children[3].children[0]);
}

function calc(el){
  const r=el.closest('tr');
  const m=+r.children[3].children[0].value||0;
  const j=+r.children[4].children[0].value||0;
  r.querySelector('.margin').innerText=j-m;
  update();
}

function update(){
  let p=0,pa=0,di=0,se=0,re=0;
  document.querySelectorAll('#tableOrder tbody tr').forEach(r=>{
    const mar=+r.querySelector('.margin').innerText||0; p+=mar;
    const s=r.querySelector('select').value;
    r.className='status-'+s;
    if(s==='Packing')pa++; if(s==='Dikirim')di++; if(s==='Selesai')se++; if(s==='Return')re++;
  });
  totalOrder.innerText=pa+di+se+re;
  packing.innerText=pa; dikirim.innerText=di; selesai.innerText=se; retur.innerText=re;
  profit.innerText='Rp '+p.toLocaleString('id-ID');
  saveOrders();
  drawChart();
}

function saveOrders(){
  const data=[];
  document.querySelectorAll('#tableOrder tbody tr').forEach(r=>{
    data.push({tanggal:r.children[0].children[0].value,no:r.children[1].children[0].value,produk:r.children[2].children[0].value,modal:r.children[3].children[0].value,jual:r.children[4].children[0].value,status:r.children[6].children[0].value});
  });
  localStorage.setItem(ORDER_KEY,JSON.stringify(data));
}

function loadOrders(){
  const d=JSON.parse(localStorage.getItem(ORDER_KEY)||'[]');
  d.forEach(addRow);
  update();
}

/* ===== CHART ===== */
let chart;
function drawChart(){
  const ctx=document.getElementById('profitChart');
  const labels=[],values=[];
  document.querySelectorAll('#tableOrder tbody tr').forEach(r=>{
    const t=r.children[0].children[0].value;
    if(!t)return;
    const m=+r.querySelector('.margin').innerText||0;
    const bln=new Date(t).toLocaleDateString('id-ID',{month:'short',year:'numeric'});
    const i=labels.indexOf(bln);
    if(i===-1){labels.push(bln);values.push(m);} else values[i]+=m;
  });
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'Profit',data:values,backgroundColor:'#6c63ff'}]}});
}

/* ===== EXPORT ===== */
function exportCSV(){
  let csv='Tanggal,No,Produk,Modal,Jual,Status
';
  JSON.parse(localStorage.getItem(ORDER_KEY)||'[]').forEach(d=>{
    csv+=`${d.tanggal},${d.no},${d.produk},${d.modal},${d.jual},${d.status}
`;
  });
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download='report-shopee.csv';
  a.click();
}

/* ===== USER MANAGEMENT ===== */
function loadUsers(){
  const users=JSON.parse(localStorage.getItem(USERS_KEY));
  const tb=document.querySelector('#userTable tbody');
  tb.innerHTML='';
  users.forEach((u,i)=>{
    if(u.role==='owner')return;
    tb.innerHTML+=`<tr><td>${u.username}</td><td>${u.role}</td><td><button class="btn-danger" onclick="deleteUser(${i})">Hapus</button></td></tr>`;
  });
}

function addUser(){
  const u=newUser.value.trim();
  const p=newPass.value.trim();
  const r=newRole.value;
  if(!u||!p)return alert('Lengkapi data');
  const users=JSON.parse(localStorage.getItem(USERS_KEY));
  if(users.find(x=>x.username===u))return alert('User sudah ada');
  users.push({username:u,password:p,role:r});
  localStorage.setItem(USERS_KEY,JSON.stringify(users));
  newUser.value=newPass.value='';
  loadUsers();
}

function deleteUser(i){
  const users=JSON.parse(localStorage.getItem(USERS_KEY));
  users.splice(i,1);
  localStorage.setItem(USERS_KEY,JSON.stringify(users));
  loadUsers();
},${d.no},${d.produk},${d.modal},${d.jual},${d.status}\n`;
  });
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download='report-shopee.csv';
  a.click();
}
</script>
</body>
</html>
