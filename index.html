<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:#f1f5f9}
#loginPage{height:100vh;display:flex;align-items:center;justify-content:center}
.login-box{width:340px;background:#fff;padding:30px;border-radius:8px;box-shadow:0 15px 30px rgba(0,0,0,.12)}
.login-box h2{text-align:center}
.login-box input,button{width:100%;padding:12px;margin-top:10px}
button{background:#2563eb;color:#fff;border:none;border-radius:6px;cursor:pointer}
#error{text-align:center;color:#dc2626}

#dashboard{display:none}
.sidebar{width:240px;height:100vh;position:fixed;background:#0f172a;color:#fff;padding:20px}
.sidebar a{display:block;padding:12px;color:#cbd5f5;text-decoration:none;border-radius:6px}
.sidebar a:hover{background:#1e293b;color:#fff}
.main{margin-left:240px;padding:30px}
.card{background:#fff;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 8px 20px rgba(0,0,0,.05)}
.hidden{display:none}

table{width:100%;border-collapse:collapse}
th,td{padding:12px;border-bottom:1px solid #e5e7eb;text-align:center}
th{background:#2563eb;color:#fff}

.status{padding:5px 12px;border-radius:20px;font-size:12px;color:#fff}
.packing{background:#eab308;color:#000}
.dikirim{background:#3b82f6}
.selesai{background:#22c55e}
.return{background:#ef4444}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-box">
    <h2>Admin Login</h2>
    <input id="user" placeholder="ID User">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div id="error"></div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
<div class="sidebar">
  <h3 id="roleText"></h3>
  <a onclick="showPage('inputPage')">Input Order</a>
  <a onclick="showPage('profitPage')">Ringkasan Profit</a>
  <a onclick="showPage('bulanPage')">Profit Bulanan</a>
  <a onclick="showPage('tablePage')">Data Order</a>
  <a onclick="showPage('chartPage')" id="menuChart">Grafik Bulanan</a>
  <a onclick="logout()">Logout</a>
</div>

<div class="main">

<!-- INPUT -->
<div id="inputPage" class="card">
<h3>Input Order</h3>
<input id="noPesanan" placeholder="No Pesanan">
<input type="date" id="tanggal">
<input id="produk" placeholder="Nama Produk">
<input id="modal" placeholder="Modal (Rp)">
<input id="jual" placeholder="Jual (Rp)">
<select id="status">
<option value="packing">Packing</option>
<option value="dikirim">Dikirim</option>
<option value="selesai">Selesai</option>
<option value="return">Return</option>
</select>
<button onclick="tambahOrder()">Simpan</button>
</div>

<!-- PROFIT TOTAL -->
<div id="profitPage" class="card hidden">
<h3>Ringkasan Profit</h3>

<table>
<tr><th>Total Order</th><th>Total Profit</th></tr>
<tr>
<td id="totalOrder"></td>
<td id="totalProfit"></td>
</tr>
</table>

<br>

<table>
<thead>
<tr>
<th>Status</th>
<th>Total Order</th>
<th>Total Profit</th>
</tr>
</thead>
<tbody id="profitStatus"></tbody>
</table>
</div>

<!-- PROFIT BULANAN -->
<div id="bulanPage" class="card hidden">
<h3>Profit Per Bulan</h3>
<table>
<thead>
<tr><th>Bulan</th><th>Total Order</th><th>Total Profit</th></tr>
</thead>
<tbody id="bulanTable"></tbody>
</table>
</div>

<!-- DATA ORDER -->
<div id="tablePage" class="card hidden">
<h3>Data Order</h3>
<input id="searchOrder" placeholder="Cari No Pesanan / Produk" oninput="renderTable()">
<button onclick="exportExcel()">Export Excel</button>
<table>
<thead>
<tr>
<th>No</th><th>Tanggal</th><th>Produk</th>
<th>Modal</th><th>Jual</th><th>Profit</th>
<th>Status</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<!-- CHART -->
<div id="chartPage" class="card hidden">
<h3>Grafik Profit Per Bulan</h3>
<canvas id="profitChart"></canvas>
</div>

</div>
</div>

<script>
var users=[
{id:"owner",password:"owner123",role:"Owner"},
{id:"admin",password:"admin123",role:"Admin"},
{id:"staff",password:"staff123",role:"Staff"}
];

var orders=JSON.parse(localStorage.getItem("orders")||"[]");
var role="", chart=null;

/* RUPIAH */
function rupiah(n){return "Rp "+n.toLocaleString("id-ID")}
function parseRp(v){return Number(v.replace(/[^0-9]/g,""))}
modal.oninput=()=>modal.value=rupiah(parseRp(modal.value))
jual.oninput=()=>jual.value=rupiah(parseRp(jual.value))

function login(){
for(var u of users){
if(u.id===user.value&&u.password===pass.value){
role=u.role;
loginPage.style.display="none";
dashboard.style.display="block";
roleText.innerText="Role: "+role;
if(role==="Staff"){
["profitPage","bulanPage","menuChart"].forEach(id=>{
let el=document.getElementById(id); if(el) el.style.display="none";
});
}
renderAll(); return;
}}
error.innerText="Login gagal";
}

function logout(){location.reload()}

function showPage(id){
["inputPage","profitPage","bulanPage","tablePage","chartPage"].forEach(p=>{
document.getElementById(p).classList.add("hidden");
});
document.getElementById(id).classList.remove("hidden");
if(id==="chartPage") renderChart();
}

function tambahOrder(){
let m=parseRp(modal.value), j=parseRp(jual.value);
orders.push({
no:noPesanan.value,
tanggal:tanggal.value,
produk:produk.value,
modal:m,jual:j,profit:j-m,status:status.value
});
localStorage.setItem("orders",JSON.stringify(orders));
renderAll();
}

function renderAll(){
renderTable();
renderProfit();
renderBulan();
renderChart();
}

function renderTable(){
let q=searchOrder.value.toLowerCase();
tbody.innerHTML="";
orders.filter(o=>o.no.toLowerCase().includes(q)||o.produk.toLowerCase().includes(q))
.forEach(o=>{
tbody.innerHTML+=`
<tr>
<td>${o.no}</td>
<td>${o.tanggal}</td>
<td>${o.produk}</td>
<td>${role==="Staff"?"-":rupiah(o.modal)}</td>
<td>${role==="Staff"?"-":rupiah(o.jual)}</td>
<td>${role==="Staff"?"-":rupiah(o.profit)}</td>
<td><span class="status ${o.status}">${o.status}</span></td>
</tr>`;
});
}

function renderProfit(){
totalOrder.innerText=orders.length;
totalProfit.innerText=rupiah(orders.reduce((a,b)=>a+b.profit,0));

let statuses=["packing","dikirim","selesai","return"];
profitStatus.innerHTML="";
statuses.forEach(s=>{
let filtered=orders.filter(o=>o.status===s);
let totalO=filtered.length;
let totalP=filtered.reduce((a,b)=>a+b.profit,0);
profitStatus.innerHTML+=`
<tr>
<td><span class="status ${s}">${s}</span></td>
<td>${totalO}</td>
<td>${rupiah(totalP)}</td>
</tr>`;
});
}

function renderBulan(){
let map={};
orders.forEach(o=>{
let b=o.tanggal.substr(0,7);
if(!map[b]) map[b]={order:0,profit:0};
map[b].order++; map[b].profit+=o.profit;
});
bulanTable.innerHTML="";
Object.keys(map).sort().forEach(b=>{
bulanTable.innerHTML+=`
<tr>
<td>${b}</td>
<td>${map[b].order}</td>
<td>${rupiah(map[b].profit)}</td>
</tr>`;
});
}

function renderChart(){
if(chart) chart.destroy();
let map={};
orders.forEach(o=>{
let b=o.tanggal.substr(0,7);
map[b]=(map[b]||0)+o.profit;
});
chart=new Chart(profitChart,{
type:"bar",
data:{
labels:Object.keys(map),
datasets:[{label:"Profit",data:Object.values(map)}]
}
});
}

/* EXPORT EXCEL */
function exportExcel(){
let rows=[["No","Tanggal","Produk","Modal","Jual","Profit","Status"]];
orders.forEach(o=>{
rows.push([
o.no,o.tanggal,o.produk,
role==="Staff"?"":o.modal,
role==="Staff"?"":o.jual,
role==="Staff"?"":o.profit,
o.status
]);
});
let csv=rows.map(r=>r.join(",")).join("\n");
let blob=new Blob([csv],{type:"text/csv"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="data_order.csv";
a.click();
}
</script>

</body>
</html>
