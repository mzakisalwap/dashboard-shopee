<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f4f6fb}

/* LOGIN */
#loginPage{height:100vh;display:flex;align-items:center;justify-content:center}
.login-box{
  width:340px;background:#fff;padding:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.1)
}
.login-box h3{text-align:center}
.login-box input,button,select{
  width:100%;padding:10px;margin-top:10px
}
button{background:#4f46e5;color:#fff;border:none;cursor:pointer}
#error{text-align:center;color:red;margin-top:10px}

/* DASHBOARD */
#dashboard{display:none}
.sidebar{
  width:230px;height:100vh;position:fixed;
  background:#1e293b;color:#fff;padding:20px
}
.sidebar h3{margin-bottom:20px}
.sidebar a{
  display:block;color:#fff;padding:10px;
  text-decoration:none;border-radius:5px;cursor:pointer
}
.sidebar a:hover{background:#334155}

.main{margin-left:230px;padding:25px}
.card{
  background:#fff;padding:20px;
  border-radius:6px;margin-bottom:20px
}
.hidden{display:none}

/* TABLE */
table{width:100%;border-collapse:collapse}
th,td{
  border:1px solid #ddd;padding:10px;text-align:center
}
th{background:#4f46e5;color:#fff}

/* STATUS */
.status{
  padding:4px 10px;border-radius:12px;
  color:#fff;font-size:12px;font-weight:bold
}
.packing{background:#facc15;color:#000}
.dikirim{background:#3b82f6}
.selesai{background:#22c55e}
.return{background:#ef4444}

/* FILTER */
.filter{display:flex;gap:10px;margin-bottom:10px}

/* FINANCE COLUMN */
.colFinance{}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-box">
    <h3>Login</h3>
    <input id="user" placeholder="ID User">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div id="error"></div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">

  <div class="sidebar">
    <h3 id="roleText"></h3>
    <a onclick="showPage('pageInput')">Input Order</a>
    <a onclick="showPage('pageTable')">Data Order</a>
    <a onclick="showPage('pageChart')" id="menuChart">Grafik</a>
    <a onclick="logout()">Logout</a>
  </div>

  <div class="main">

    <!-- INPUT -->
    <div id="pageInput" class="card">
      <h3>Input Order</h3>
      <input id="noPesanan" placeholder="No Pesanan">
      <input type="date" id="tanggal">
      <input id="produk" placeholder="Nama Produk">
      <input type="number" id="modal" placeholder="Harga Modal">
      <input type="number" id="jual" placeholder="Harga Jual">
      <select id="status">
        <option value="packing">Packing</option>
        <option value="dikirim">Dikirim</option>
        <option value="selesai">Selesai</option>
        <option value="return">Return</option>
      </select>
      <button onclick="tambahOrder()">Simpan Order</button>
    </div>

    <!-- TABLE -->
    <div id="pageTable" class="card hidden">
      <h3>Data Order</h3>

      <div class="filter">
        <input type="date" id="filterTanggal">
        <input type="month" id="filterBulan">
        <button onclick="renderTable()">Filter</button>
        <button onclick="resetFilter()">Reset</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>No Pesanan</th>
            <th>Tanggal</th>
            <th>Produk</th>
            <th class="colFinance">Modal</th>
            <th class="colFinance">Jual</th>
            <th class="colFinance">Profit</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- CHART -->
    <div id="pageChart" class="card hidden">
      <h3>Grafik Profit</h3>
      <canvas id="profitChart"></canvas>
    </div>

  </div>
</div>

<script>
/* USERS */
var users=[
{id:"owner",password:"owner123",role:"Owner"},
{id:"admin",password:"admin123",role:"Admin"},
{id:"staff",password:"staff123",role:"Staff"}
];

var orders=JSON.parse(localStorage.getItem("orders")||"[]");
var currentRole="";
var chart=null;

/* LOGIN */
function login(){
  for(var i=0;i<users.length;i++){
    if(users[i].id===user.value.trim() &&
       users[i].password===pass.value.trim()){
      currentRole=users[i].role;
      loginPage.style.display="none";
      dashboard.style.display="block";
      roleText.innerHTML="Role: "+currentRole;

      if(currentRole==="Staff"){
        menuChart.style.display="none";
        var cols=document.getElementsByClassName("colFinance");
        for(var j=0;j<cols.length;j++) cols[j].style.display="none";
      }
      showPage("pageTable");
      renderTable();
      return;
    }
  }
  error.innerHTML="ID atau Password salah";
}

/* LOGOUT */
function logout(){
  location.reload();
}

/* MENU */
function showPage(id){
  pageInput.classList.add("hidden");
  pageTable.classList.add("hidden");
  pageChart.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
  if(id==="pageChart") renderChart();
}

/* TAMBAH ORDER */
function tambahOrder(){
  orders.push({
    no:noPesanan.value,
    tanggal:tanggal.value,
    produk:produk.value,
    modal:Number(modal.value),
    jual:Number(jual.value),
    profit:Number(jual.value)-Number(modal.value),
    status:status.value
  });
  localStorage.setItem("orders",JSON.stringify(orders));
  alert("Order tersimpan");
  showPage("pageTable");
  renderTable();
}

/* RENDER TABLE + EDIT STATUS */
function renderTable(){
  tbody.innerHTML="";
  for(var i=0;i<orders.length;i++){
    var o=orders[i];

    if(filterTanggal.value && o.tanggal!==filterTanggal.value) continue;
    if(filterBulan.value && o.tanggal.substr(0,7)!==filterBulan.value) continue;

    var statusHTML="";
    if(currentRole!=="Staff"){
      statusHTML=
      "<select onchange='updateStatus("+i+",this.value)' class='"+o.status+"'>"+
      "<option value='packing'>Packing</option>"+
      "<option value='dikirim'>Dikirim</option>"+
      "<option value='selesai'>Selesai</option>"+
      "<option value='return'>Return</option>"+
      "</select>";
    }else{
      statusHTML="<span class='status "+o.status+"'>"+o.status+"</span>";
    }

    tbody.innerHTML+=
      "<tr>"+
      "<td>"+o.no+"</td>"+
      "<td>"+o.tanggal+"</td>"+
      "<td>"+o.produk+"</td>"+
      "<td class='colFinance'>"+o.modal+"</td>"+
      "<td class='colFinance'>"+o.jual+"</td>"+
      "<td class='colFinance'>"+o.profit+"</td>"+
      "<td>"+statusHTML+"</td>"+
      "</tr>";
  }

  if(currentRole!=="Staff"){
    var selects=tbody.querySelectorAll("select");
    for(var k=0;k<selects.length;k++){
      selects[k].value=orders[k].status;
    }
  }
}

/* UPDATE STATUS */
function updateStatus(i,val){
  orders[i].status=val;
  localStorage.setItem("orders",JSON.stringify(orders));
  renderTable();
}

/* RESET FILTER */
function resetFilter(){
  filterTanggal.value="";
  filterBulan.value="";
  renderTable();
}

/* GRAFIK */
function renderChart(){
  if(chart) chart.destroy();
  var labels=[], data=[];
  for(var i=0;i<orders.length;i++){
    labels.push(orders[i].produk);
    data.push(orders[i].profit);
  }
  chart=new Chart(profitChart,{
    type:"bar",
    data:{
      labels:labels,
      datasets:[{label:"Profit",data:data}]
    }
  });
}
</script>

</body>
</html>
