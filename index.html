<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Report Shopee</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}
h1 { text-align: center; }
.dashboard {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 15px;
  margin-bottom: 20px;
}
.card {
  background: white;
  padding: 15px;
  border-radius: 8px;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
}
.card h2 { margin: 0; font-size: 14px; color: #666; }
.card p { font-size: 22px; font-weight: bold; margin: 5px 0 0; }

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  border-radius: 8px;
  overflow: hidden;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
th { background: #ff5722; color: white; }

button {
  padding: 6px 10px;
  border: none;
  background: #ff5722;
  color: white;
  border-radius: 5px;
  cursor: pointer;
}
button:hover { opacity: .85; }

.status-packing { background:#fff3cd; }
.status-dikirim { background:#d1ecf1; }
.status-selesai { background:#d4edda; }
.status-return { background:#f8d7da; }
</style>
</head>

<body>

<h1>Dashboard Report Order Shopee</h1>

<div class="dashboard">
  <div class="card"><h2>Total Order</h2><p id="totalOrder">0</p></div>
  <div class="card"><h2>Total Margin</h2><p id="totalMargin">Rp 0</p></div>
  <div class="card"><h2>Selesai</h2><p id="orderSelesai">0</p></div>
  <div class="card"><h2>Return</h2><p id="orderReturn">0</p></div>
</div>

<button onclick="addRow()">+ Tambah Order</button>
<button onclick="exportCSV()">Export CSV</button>

<br><br>

<table id="tableOrder">
<thead>
<tr>
<th>Tanggal</th>
<th>No Pesanan</th>
<th>Produk</th>
<th>Modal</th>
<th>Jual</th>
<th>Margin</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const STORAGE_KEY = 'shopee_orders';

function saveData() {
  const rows = document.querySelectorAll('#tableOrder tbody tr');
  const data = [];
  rows.forEach(r => {
    data.push({
      tanggal: r.cells[0].querySelector('input').value,
      pesanan: r.cells[1].querySelector('input').value,
      produk: r.cells[2].querySelector('input').value,
      modal: r.cells[3].querySelector('input').value,
      jual: r.cells[4].querySelector('input').value,
      margin: r.querySelector('.margin').innerText,
      status: r.querySelector('select').value
    });
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function loadData() {
  const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  data.forEach(d => addRow(d));
}

function addRow(data = {}) {
  const tbody = document.querySelector('#tableOrder tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
<td><input type="date" value="${data.tanggal||''}"></td>
<td><input value="${data.pesanan||''}"></td>
<td><input value="${data.produk||''}"></td>
<td><input type="number" value="${data.modal||''}" oninput="calc(this)"></td>
<td><input type="number" value="${data.jual||''}" oninput="calc(this)"></td>
<td class="margin">${data.margin||0}</td>
<td>
<select onchange="updateStatus(this)">
<option value="packing">Packing</option>
<option value="dikirim">Dikirim</option>
<option value="selesai">Selesai</option>
<option value="return">Return</option>
</select>
</td>
<td><button onclick="this.closest('tr').remove();updateDashboard();saveData()">Hapus</button></td>
`;
  tbody.appendChild(tr);
  tr.querySelector('select').value = data.status || 'packing';
  updateStatus(tr.querySelector('select'));
  updateDashboard();
  saveData();
}

function calc(el){
  const row = el.closest('tr');
  const modal = +row.cells[3].querySelector('input').value || 0;
  const jual = +row.cells[4].querySelector('input').value || 0;
  row.querySelector('.margin').innerText = jual - modal;
  updateDashboard();
  saveData();
}

function updateStatus(sel){
  const row = sel.closest('tr');
  row.className = 'status-' + sel.value;
  updateDashboard();
  saveData();
}

function updateDashboard(){
  const rows = document.querySelectorAll('#tableOrder tbody tr');
  let margin=0, selesai=0, ret=0;
  rows.forEach(r=>{
    margin += +r.querySelector('.margin').innerText || 0;
    if(r.querySelector('select').value==='selesai') selesai++;
    if(r.querySelector('select').value==='return') ret++;
  });
  totalOrder.innerText = rows.length;
  totalMargin.innerText = 'Rp ' + margin.toLocaleString('id-ID');
  orderSelesai.innerText = selesai;
  orderReturn.innerText = ret;
}

function exportCSV(){
  let csv='Tanggal,Pesanan,Produk,Modal,Jual,Margin,Status\n';
  document.querySelectorAll('#tableOrder tbody tr').forEach(r=>{
    csv+=`${r.cells[0].querySelector('input').value},${r.cells[1].querySelector('input').value},${r.cells[2].querySelector('input').value},${r.cells[3].querySelector('input').value},${r.cells[4].querySelector('input').value},${r.querySelector('.margin').innerText},${r.querySelector('select').value}\n`;
  });
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download='report-shopee.csv';
  a.click();
}

window.onload = loadData;
</script>

</body>
</html>
