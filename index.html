<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Bisnis Shopee</title>
<style>
body{font-family:Arial;background:#f4f6fb;margin:0}
#loginBox{max-width:350px;margin:100px auto;background:#fff;padding:25px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
#loginBox input,#loginBox button{width:100%;padding:10px;margin:8px 0}
#loginBox button{background:#6c63ff;color:#fff;border:none;border-radius:8px;cursor:pointer}
#app{display:none;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center}
.card{background:#fff;padding:15px;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.08);margin:10px}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.admin-only{background:#ff6b6b;color:#fff}
.staff-hide{display:none}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center}
select,input{padding:6px}
</style>
</head>
<body>

<div id="loginBox">
  <h2>Login Dashboard</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="app">
  <div class="header">
    <h2>Dashboard Bisnis Shopee</h2>
    <div>
      <span id="roleInfo"></span>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="dashboard">
    <div class="card">Total Order<br><b id="totalOrder">0</b></div>
    <div class="card">Packing<br><b id="packing">0</b></div>
    <div class="card">Dikirim<br><b id="dikirim">0</b></div>
    <div class="card">Selesai<br><b id="selesai">0</b></div>
    <div class="card">Return<br><b id="retur">0</b></div>
    <div class="card">Total Profit<br><b id="profit">Rp 0</b></div>
  </div>

  <div class="card">
    <button onclick="addRow()">+ Tambah Order</button>
    <button class="admin-only" onclick="exportCSV()">Export CSV</button>
    <table id="tableOrder">
      <thead>
        <tr>
          <th>Tanggal</th><th>No Pesanan</th><th>Produk</th><th>Modal</th><th>Jual</th><th>Margin</th><th>Status</th><th class="admin-only">Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script>
const USERS_KEY="shopee_users";
const ORDER_KEY="shopee_orders";

if(!localStorage.getItem(USERS_KEY)){
  localStorage.setItem(USERS_KEY,JSON.stringify([
    {username:"owner",password:"owner123",role:"owner"},
    {username:"admin",password:"admin123",role:"admin"},
    {username:"staff",password:"staff123",role:"staff"}
  ]));
}

function login(){
  const u=document.getElementById('username').value;
  const p=document.getElementById('password').value;
  const users=JSON.parse(localStorage.getItem(USERS_KEY));
  const found=users.find(x=>x.username===u&&x.password===p);
  if(!found)return alert('Login salah');
  localStorage.setItem('currentUser',JSON.stringify(found));
  document.getElementById('loginBox').style.display='none';
  document.getElementById('app').style.display='block';
  document.getElementById('roleInfo').innerText='Role: '+found.role;
  applyRole(found.role);
  loadOrders();
}

function logout(){
  localStorage.removeItem("currentUser");
  location.reload();
}


function applyRole(role){
  if(role==='staff'){
    document.querySelectorAll('.admin-only').forEach(e=>e.style.display='none');
  }
}

function addRow(data={}){
  const tr=document.createElement('tr');
  tr.innerHTML=`
  <td><input type=date value="${data.tanggal||''}"></td>
  <td><input value="${data.no||''}"></td>
  <td><input value="${data.produk||''}"></td>
  <td><input type=number value="${data.modal||0}" oninput=calc(this)></td>
  <td><input type=number value="${data.jual||0}" oninput=calc(this)></td>
  <td class=margin>0</td>
  <td>
    <select onchange=update()>
      <option>Packing</option><option>Dikirim</option><option>Selesai</option><option>Return</option>
    </select>
  </td>
  <td class="admin-only"><button onclick="this.parentElement.parentElement.remove();update()">Hapus</button></td>`;
  document.querySelector('#tableOrder tbody').appendChild(tr);
  update();
}

function calc(el){const tr=el.closest('tr');tr.querySelector('.margin').innerText=(tr.children[4].children[0].value-tr.children[3].children[0].value)||0;update();}

function update(){
  const rows=document.querySelectorAll('#tableOrder tbody tr');
  let p=0,pa=0,di=0,se=0,re=0;
  rows.forEach(r=>{
    p+=+r.querySelector('.margin').innerText||0;
    const s=r.querySelector('select').value;
    if(s==='Packing')pa++; if(s==='Dikirim')di++; if(s==='Selesai')se++; if(s==='Return')re++;
  });
  totalOrder.innerText=rows.length; packing.innerText=pa; dikirim.innerText=di; selesai.innerText=se; retur.innerText=re; profit.innerText='Rp '+p.toLocaleString('id-ID');
  save();
}

function save(){
  const data=[];
  document.querySelectorAll('#tableOrder tbody tr').forEach(r=>{
    data.push({tanggal:r.children[0].children[0].value,no:r.children[1].children[0].value,produk:r.children[2].children[0].value,modal:r.children[3].children[0].value,jual:r.children[4].children[0].value,status:r.children[6].children[0].value});
  });
  localStorage.setItem(ORDER_KEY,JSON.stringify(data));
}

function loadOrders(){JSON.parse(localStorage.getItem(ORDER_KEY)||'[]').forEach(addRow);}

function exportCSV(){let c='Tanggal,No,Produk,Modal,Jual,Status\n';JSON.parse(localStorage.getItem(ORDER_KEY)||'[]').forEach(d=>c+=`${d.tanggal},${d.no},${d.produk},${d.modal},${d.jual},${d.status}\n`);const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:'text/csv'}));a.download='shopee-report.csv';a.click();}
</script>
</body>
</html>

